<link type="text/css" href="~/Content/fullcalendar.min.css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/moment.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery-ui-1.11.3.min.js"></script>
<script type="text/javascript" src="~/Scripts/fullcalendar.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $("#calendar").fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            defaultView: 'agendaWeek',
            editable: true,
            selectable: true,
            events: '/Customers/GetUserTimesheet',
            select: function (start, end, allDay) {
                $('#date').val(moment(start).format('DD/MM/YYYY'));
                $('#startTime').val(moment(start).format('HH:mm:ss'));
                $('#endTime').val(moment(end).format('HH:mm:ss'));
                ShowModalPopup();
            }
        });
    });
</script>

<script type="text/javascript">
    function ClearModalFormValues() {
        $('#date').val("");
        $('#startTime').val("");
        $('#endTime').val("");
    }
</script>

<script type="text/javascript">
    function ShowModalPopup() {
        //ClearModalFormValues();
        $('#newEventModal').modal('show');
        $('#startTime').focus();
    };
</script>

<script type="text/javascript">
    $('#btnPopupSave').click(function () {
        $('#newEventModal').modal('hide');
        var dataRow = {
            'NewEventDate': $('#date').val(),
            'NewEventTime': $('#eventTime').val(),
        }
        ClearModalFormValues();
        $.ajax({
            type: 'POST',
            url: '/Drivers/SaveNewAvailability',
            data: dataRow,
            datatype: 'json',
            success: function (response) {
                if (response == 'True') {
                    $('#calendar').fullCalendar('refetchEvents');
                    alert('New availability saved!');
                }
                else {
                    alert('Error, could not save availability!');
                }
            }
        });
    });
</script>

<h2>My Timesheet</h2>
<hr />
<div id="calendar"></div>
<div id="newEventModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h3>Add New Availability</h3></div>
            <div class="modal-body">
                <form id="EventForm" class="well">
                    <label>Date</label><br />
                    <input type="text" id="date"><br /><br />
                    <label>Available Start Time</label><br />
                    <input type="text" id="startTime"><br /><br />
                    <label>Available End Time</label><br />
                    <input type="text" id="endTime"><br />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnPopupCancel" data-dismiss="modal" class="btn">Cancel</button>
                <button type="button" id="btnPopupSave" data-dismiss="modal" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>
